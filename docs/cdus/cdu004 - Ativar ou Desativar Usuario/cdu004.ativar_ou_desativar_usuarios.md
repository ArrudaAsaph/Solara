# CDU004 – Ativar / Desativar Usuário

> **Arquivo:** `cdu004_ativar_ou_desativar_usuarios.md`
> **Descrição:** Caso de uso referente à ativação ou desativação de usuários no sistema. Pode ser executado pela **Empresa** (para qualquer nível, incluindo gerentes) ou pelo **Gerente** (apenas usuários de nível inferior vinculados à mesma empresa). Não é permitido remover usuários — apenas alternar seu status, preservando os dados históricos.

---

## Identificação

| **Campo** | **Valor** |
| :-------- | :-------- |
| **Código** | CDU004 |
| **Ator Principal** | Empresa / Gerente |
| **Atores Secundários** | Sistema |
| **Requisito Atendido** | [RF03](../../requisitos/requisitos_funcionais.md#rf03) / [RF19](../../requisitos/requisitos_funcionais.md#rf19) |

---

## Resumo

Permite ao ator alterar o status de um usuário vinculado à empresa, ativando-o ou desativando-o sem remover seus dados do sistema. O escopo de quem pode ser ativado ou desativado depende do ator:

| **Ator** | **Pode ativar/desativar** |
| :------- | :------------------------ |
| **Empresa** | Qualquer usuário da empresa, incluindo gerentes |
| **Gerente** | Apenas usuários de nível hierarquicamente inferior ao seu, vinculados à mesma empresa |

### Efeitos do status

| **Status** | **Efeito** |
| :--------: | :--------- |
| **Ativo** | Usuário pode autenticar e acessar as funcionalidades do sistema conforme seu perfil |
| **Inativo** | Usuário fica imediatamente impedido de autenticar ou acessar qualquer funcionalidade do sistema |

---

## Pré-condições

- O ator deve estar autenticado no sistema.
- O ator deve estar ativo e vinculado a uma empresa ativa.
- O usuário alvo deve estar vinculado à mesma empresa do ator.
- O usuário alvo deve possuir papel hierarquicamente inferior ao do ator ([RN16](../../regras_de_negocio/regras_de_negocio.md#rn16)).

---

## Pós-condições

- O status do usuário é alterado para ativo ou inativo.
- Os dados históricos do usuário são preservados.
- O histórico da alteração é registrado com identificação do ator responsável, data e hora.
- Usuários desativados ficam imediatamente impedidos de autenticar no sistema.

---

## Mapeamento: CDU → Requisitos Funcionais

| **Requisito** | **Descrição** |
| :------------ | :------------ |
| [**RF03**](../../requisitos/requisitos_funcionais.md#rf03) | A empresa ou o gerente pode ativar ou desativar usuários, impedindo o acesso ao sistema sem excluir dados históricos. |
| [**RF19**](../../requisitos/requisitos_funcionais.md#rf19) | A ativação ou desativação de usuários deve exigir confirmação de senha do ator administrativo responsável pela ação. |

---

## Mapeamento: CDU → Regras de Negócio

| **Código** | **Descrição** |
| :--------: | :------------ |
| [**RN02**](../../regras_de_negocio/regras_de_negocio.md#rn02) | Apenas empresas podem ativar ou desativar usuários do tipo gerente. O gerente não pode alterar o status de outro gerente. |
| [**RN04**](../../regras_de_negocio/regras_de_negocio.md#rn04) | Não deve ser possível remover um usuário do sistema, apenas ativá-lo ou desativá-lo, preservando os dados históricos. |
| [**RN05**](../../regras_de_negocio/regras_de_negocio.md#rn05) | A empresa ou o gerente pode ativar ou desativar apenas usuários vinculados à mesma empresa à qual pertence. |
| [**RN06**](../../regras_de_negocio/regras_de_negocio.md#rn06) | Usuários desativados não podem autenticar nem acessar funcionalidades do sistema. |
| [**RN16**](../../regras_de_negocio/regras_de_negocio.md#rn16) | Um usuário somente pode ativar ou desativar usuários com papel hierarquicamente inferior ao seu. |
| [**RN22**](../../regras_de_negocio/regras_de_negocio.md#rn22) | A ativação ou desativação de usuário exige confirmação de senha do ator administrativo responsável pela ação. |

---

## Fluxo Principal

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 1 | Acessa a opção "Listar Usuários". | |
| 2 | | Exibe a listagem de usuários dentro do escopo do ator (conforme [RN16](../../regras_de_negocio/regras_de_negocio.md#rn16)), com o status atual de cada um visível. |
| 3 | Seleciona um usuário da listagem. | |
| 4 | | Exibe os dados do usuário com seu status atual destacado (ativo ou inativo). |
| 5 | Seleciona a opção "Ativar" ou "Desativar" conforme o status atual do usuário. | |
| 6 | | Exibe modal de confirmação informando a ação que será realizada e solicitando a senha do ator administrativo. |
| 7 | Informa a senha e confirma a ação no modal. | |
| 8 | | Valida as Regras de Negócio [**RN02**](../../regras_de_negocio/regras_de_negocio.md#rn02) (se aplicável), [**RN04**](../../regras_de_negocio/regras_de_negocio.md#rn04), [**RN05**](../../regras_de_negocio/regras_de_negocio.md#rn05), [**RN16**](../../regras_de_negocio/regras_de_negocio.md#rn16) e [**RN22**](../../regras_de_negocio/regras_de_negocio.md#rn22). |
| 9 | | Atualiza o status do usuário no sistema. |
| 10 | | Se o usuário foi **desativado:** invalida imediatamente quaisquer sessões ativas do usuário, impedindo acesso ao sistema conforme [**RN06**](../../regras_de_negocio/regras_de_negocio.md#rn06). |
| 11 |  Visualiza o usuário com o novo status atualizado e confirmação de sucesso. | |

---

## Fluxos de Exceção

### Fluxo de Exceção I – Tentativa de alterar status de usuário fora do escopo

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.1 | Tenta ativar ou desativar usuário não vinculado à sua empresa ou de nível hierárquico igual/superior. | |
| 0.2 | | Valida as Regras de Negócio [**RN05**](../../regras_de_negocio/regras_de_negocio.md#rn05) e [**RN16**](../../regras_de_negocio/regras_de_negocio.md#rn16). |
| 0.3 | | Bloqueia a ação e exibe mensagem de acesso não autorizado. |

### Fluxo de Exceção II – Cancelamento no modal de confirmação

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.4 | Cancela a ação no modal de confirmação. | |
| 0.5 | | Descarta a operação. Retorna à tela do usuário com o status original mantido. Nenhuma alteração é persistida. |

### Fluxo de Exceção III – Senha incorreta na confirmação

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.6 | Informa senha incorreta no modal de confirmação. | |
| 0.7 | | Valida a senha e detecta que está incorreta. |
| 0.8 | | Mantém o modal aberto e exibe mensagem de senha inválida. Nenhuma alteração é aplicada. |
