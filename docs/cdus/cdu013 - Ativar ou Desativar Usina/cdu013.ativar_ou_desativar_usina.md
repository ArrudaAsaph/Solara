# CDU013 – Ativar / Desativar Usina

> **Arquivo:** `cdu013_ativar_ou_desativar_usina.md`
> **Descrição:** Caso de uso referente à ativação ou desativação de usinas no sistema. Pode ser executado por **Empresa** ou **Gerente**, respeitando o escopo da própria empresa.

---

## Identificação

| **Campo** | **Valor** |
| :-------- | :-------- |
| **Código** | CDU013 |
| **Ator Principal** | Empresa / Gerente |
| **Atores Secundários** | Sistema |
| **Requisito Atendido** | [RF09](../../requisitos/requisitos_funcionais.md#rf09) |

---

## Resumo

Permite ao ator alterar o status da usina para ativa ou inativa, sem excluir seus dados históricos. Usinas desativadas não podem ser usadas em novos contratos, novos rateios ou novas vinculações operacionais.

---

## Pré-condições

- O ator deve estar autenticado no sistema.
- O ator deve estar ativo e vinculado a uma empresa ativa.
- A usina alvo deve estar vinculada à mesma empresa do ator.

---

## Pós-condições

- O status da usina é atualizado para ativo ou inativo.
- Os dados históricos da usina são preservados.
- O histórico da alteração de status é registrado.

---

## Mapeamento: CDU → Requisitos Funcionais

| **Requisito** | **Descrição** |
| :------------ | :------------ |
| [**RF09**](../../requisitos/requisitos_funcionais.md#rf09) | A empresa ou o gerente pode ativar ou desativar uma usina, impedindo seu uso em novos contratos sem excluir seus dados históricos. |

---

## Mapeamento: CDU → Regras de Negócio

| **Código** | **Descrição** |
| :--------: | :------------ |
| [**RN12**](../../regras_de_negocio/regras_de_negocio.md#rn12) | Apenas empresa e gerentes podem ativar ou desativar usinas. |
| [**RN30**](../../regras_de_negocio/regras_de_negocio.md#rn30) | A ativação/desativação de usina só pode ocorrer para usinas vinculadas à mesma empresa do ator (empresa ou gerente). |
| [**RN31**](../../regras_de_negocio/regras_de_negocio.md#rn31) | Usinas desativadas não podem ser usadas em novos contratos, novos rateios ou novas vinculações operacionais até serem reativadas. |

---

## Fluxo Principal

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 1 | Acessa a opção "Listar Usinas". | |
| 2 | | Exibe as usinas dentro do escopo da empresa do ator, com status atual. |
| 3 | Seleciona uma usina da listagem. | |
| 4 | | Exibe os dados da usina com o status atual destacado. |
| 5 | Seleciona a opção "Ativar" ou "Desativar". | |
| 6 | | Exibe modal de confirmação da alteração de status. |
| 7 | Confirma a ação. | |
| 8 | | Valida as Regras de Negócio [**RN12**](../../regras_de_negocio/regras_de_negocio.md#rn12), [**RN30**](../../regras_de_negocio/regras_de_negocio.md#rn30) e [**RN31**](../../regras_de_negocio/regras_de_negocio.md#rn31). |
| 9 | | Atualiza o status da usina e registra histórico da alteração. |
| 10 | Visualiza a usina com novo status e confirmação de sucesso. | |

---

## Fluxos de Exceção

### Fluxo de Exceção I – Tentativa de alterar status de usina fora do escopo

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.1 | Tenta alterar o status de usina não vinculada à sua empresa. | |
| 0.2 | | Valida as Regras de Negócio [**RN12**](../../regras_de_negocio/regras_de_negocio.md#rn12) e [**RN30**](../../regras_de_negocio/regras_de_negocio.md#rn30). |
| 0.3 | | Bloqueia a ação e exibe mensagem de acesso não autorizado. |

### Fluxo de Exceção II – Cancelamento da confirmação

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.4 | Cancela a alteração no modal de confirmação. | |
| 0.5 | | Descarta a operação e mantém o status original da usina. |
