# CDU012 – Atualizar Usina

> **Arquivo:** `cdu012_atualizar_usinas.md`
> **Descrição:** Caso de uso referente à atualização dos dados cadastrais e técnicos de usinas vinculadas à empresa. Pode ser executado por **Empresa** ou **Gerente**, respeitando escopo de vínculo empresarial.

---

## Identificação

| **Campo** | **Valor** |
| :-------- | :-------- |
| **Código** | CDU012 |
| **Ator Principal** | Empresa / Gerente |
| **Atores Secundários** | Sistema |
| **Requisito Atendido** | RF08 |

---

## Resumo

Permite ao ator atualizar dados cadastrais e técnicos de uma usina já cadastrada, mantendo o histórico das alterações. O ator só pode atualizar usinas vinculadas à mesma empresa da qual faz parte.

---

## Pré-condições

- O ator deve estar autenticado no sistema.
- O ator deve estar ativo e vinculado a uma empresa ativa.
- A usina alvo deve estar vinculada à mesma empresa do ator.

---

## Pós-condições

- Os dados da usina são atualizados com sucesso.
- O histórico das alterações é registrado com identificação do ator responsável, data e hora.

---

## Mapeamento: CDU → Requisitos Funcionais

| **Requisito** | **Descrição** |
| :------------ | :------------ |
| **RF08** | A empresa ou o gerente pode atualizar os dados cadastrais e técnicos de uma usina, mantendo o histórico das alterações. |

---

## Mapeamento: CDU → Regras de Negócio

| **Código** | **Descrição** |
| :--------: | :------------ |
| **RN12** | Apenas empresa e gerentes podem atualizar usinas. |
| **RN27** | A atualização de usina só pode ocorrer quando a usina estiver vinculada à mesma empresa do ator. |
| **RN11** | Não deve existir mais de uma usina com o mesmo identificador dentro da mesma empresa. |
| **RN13** | Todas as usinas devem ter um endereço cadastrado no sistema, associado à própria usina. |
| **RN14** | Uma usina não pode ter mais de um endereço cadastrado. |
| **RN28** | Alterações em dados sensíveis da usina exigem confirmação de senha do ator administrativo. |

---

## Fluxo Principal

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 1 | Acessa a opção "Listar Usinas". | |
| 2 | | Exibe as usinas dentro do escopo da empresa do ator. |
| 3 | Seleciona uma usina da listagem. | |
| 4 | | Exibe os dados atuais da usina selecionada. |
| 5 | Seleciona a opção "Editar". | |
| 6 | | Exibe o formulário de edição com os dados atuais preenchidos. |
| 7 | Atualiza os dados desejados e confirma. | |
| 8 | | Se houver alteração em dado sensível da usina, solicita senha do ator administrativo. |
| 9 | | Valida as Regras de Negócio **RN11**, **RN12**, **RN13**, **RN14**, **RN27** e **RN28**. |
| 10 | | Salva as alterações e registra o histórico. |
| 11 | Visualiza os dados atualizados com confirmação de sucesso. | |

---

## Fluxos de Exceção

### Fluxo de Exceção I – Tentativa de atualizar usina fora da empresa

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.1 | Tenta atualizar usina não vinculada à sua empresa. | |
| 0.2 | | Valida as Regras de Negócio **RN12** e **RN27**. |
| 0.3 | | Bloqueia a ação e exibe mensagem de acesso não autorizado. |

### Fluxo de Exceção II – Falha na validação dos dados

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.4 | Informa dados inválidos ou incompletos. | |
| 0.5 | | Valida os dados e identifica inconsistências. |
| 0.6 | | Exibe mensagens de erro indicando os campos inválidos. |
| 0.7 | Corrige os dados e confirma novamente. | |

### Fluxo de Exceção III – Senha incorreta na confirmação

| **Passo** | **Ações do Ator** | **Ações do Sistema** |
| :-------: | :---------------- | :------------------- |
| 0.8 | Informa senha incorreta quando solicitada para confirmar alteração sensível. | |
| 0.9 | | Mantém a operação pendente e exibe mensagem de senha inválida. |
| 0.10 | Informa a senha correta e confirma novamente. | |
